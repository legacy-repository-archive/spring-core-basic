# ê°ì²´ì§€í–¥ ì›ë¦¬ ì ìš©
## ìƒˆë¡œìš´ í• ì¸ ì •ì±… ê°œë°œ    
* **ì•…ë• ê¸°íšì :** 
  ì„œë¹„ìŠ¤ ì˜¤í”ˆ ì§ì „ì— í• ì¸ ì •ì±…ì„ ì§€ê¸ˆì²˜ëŸ¼ ê³ ì • ê¸ˆì•¡ í• ì¸ì´ ì•„ë‹ˆë¼    
  ì¢€ ë” í•©ë¦¬ì ì¸ ì£¼ë¬¸ ê¸ˆì•¡ë‹¹ í• ì¸í•˜ëŠ” ì •ë¥  í• ì¸ìœ¼ë¡œ ë°”ê¾¸ê³  ì‹¶ì–´ìš” 
  ì˜ˆë¥¼ ë“¤ë©´, VIPëŠ” 10% í• ì¸ì„ ì‹œì¼œì£¼ëŠ”ê±°ì£    
* **ìˆœì§„ ê°œë°œì :**   
  ì²˜ìŒ ë¶€í„° ê·¸ê±´ ì•„ë‹ˆë¼ê³  í–ˆì–ì•„ìš”...
* **ì•…ë• ê¸°íšì :**    
  **[ì• ìì¼ ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ ì„ ì–¸](https://agilemanifesto.org/iso/ko/manifesto.html) ëª°ë¼ìš”? ê³„íšì„ ë”°ë¥´ê¸°ë³´ë‹¤ëŠ” ë³€í™”ì— ëŒ€ì‘í•˜ê¸°ë¥¼..**   
      
ì´ì „ì— ì‘ì„±í–ˆë˜ `DiscountPolicy` ì¸í„°í˜ì´ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ, `DiscountPolicy` í´ë˜ìŠ¤ë¥¼ êµ¬í˜„í•œë‹¤.       

**DiscountPolicy êµ¬í˜„**
```java
package hello.core.discount;

import hello.core.member.Grade;
import hello.core.member.Member;

public class RateDiscountPolicy implements DiscountPolicy{

    private int discountPercent = 10;

    @Override
    public int discount(Member member, int price) {
        if(member.getGrade() == Grade.VIP){
            return price * discountPercent / 100;
        }
        return 0;
    }
}
```
   
**DiscountPolicy í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ DiscountPolicyTest êµ¬í˜„**    
```java
package hello.core.discount;

import hello.core.member.Grade;
import hello.core.member.Member;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;

import static org.assertj.core.api.Assertions.assertThat;
import static org.junit.jupiter.api.Assertions.*;

class RateDiscountPolicyTest {

    DiscountPolicy discountPolicy = new RateDiscountPolicy();


    @Test
    @DisplayName("VIPëŠ” 10% í• ì¸ì´ ì ìš©ë˜ì–´ì•¼ í•œë‹¤")
    void vip_o() {
        // given
        Member member = new Member(1L, "memberVIP", Grade.VIP);

        // when
        int discount = discountPolicy.discount(member, 10000);

        // then
        assertThat(discount).isEqualTo(1000);
    }

    @Test
    @DisplayName("VIPê°€ ì•„ë‹ˆë©´ 10% í• ì¸ì´ ì ìš©ë˜ì§€ ì•Šì•„ì•¼ í•œë‹¤")
    void vip_x() {
        // given
        Member member = new Member(2L, "memberVIP", Grade.BASIC);

        // when
        int discount = discountPolicy.discount(member, 10000);

        // then
        assertThat(discount).isEqualTo(0);
    }
}
```

## ìƒˆë¡œìš´ í• ì¸ ì •ì±… ì ìš©ê³¼ ë¬¸ì œì   
ìƒˆë¡œìš´ í• ì¸ ì •ì±…ì„ ì ìš©í•˜ê¸° ìœ„í•´, `OrderServiceImpl` ì½”ë“œë¥¼ ìˆ˜ì •í•˜ê³ ì í•œë‹¤.   

**ë³€ê²½ ì „**
```java
    private final MemberRepository memberRepository = new MemoryMemberRepository();
    private final DiscountPolicy discountPolicy = new FixDiscountPolicy();
```
   
**ë³€ê²½ í›„**
```java
    private final MemberRepository memberRepository = new MemoryMemberRepository();
    private final DiscountPolicy discountPolicy = new RateDiscountPolicy();
    // private final DiscountPolicy discountPolicy = new FixDiscountPolicy();
```

í•˜ì§€ë§Œ, ë§Œì•½ ì´ì™€ ê°™ì€ ì½”ë“œê°€ 100ê°œ, 1000ê°œ, 10000ê°œê°€ ìˆë‹¤ë©´...?   
ì´ê°™ì´ ì£¼ì„ì„ ì²˜ë¦¬í•˜ê³  ìƒˆë¡œìš´ í´ë˜ìŠ¤ë¥¼ ë„£ì–´ì£¼ëŠ” ì‘ì—…ì„ ì¼ì¼íˆ ë‹¤ í•´ì•¼í•œë‹¤.    

**ë¬¸ì œì  ë°œê²¬**   
* ìš°ë¦¬ëŠ” ì—­í• ê³¼ êµ¬í˜„ì„ ì¶©ì‹¤í•˜ê²Œ ë¶„ë¦¬í–ˆë‹¤ -> OK  
* ë‹¤í˜•ì„±ë„ í™œìš©í•˜ê³ , ì¸í„°í˜ì´ìŠ¤ì™€ êµ¬í˜„ì²´ë¥¼ ë¶„ë¦¬í–ˆë‹¤ -> OK
* OCP, DIP ê°™ì€ ê°ì²´ì§€í–¥ ì„¤ê³„ ì›ì¹™ì„ ì¶©ì‹¤íˆ ì¤€ìˆ˜í–ˆë‹¤. -> âŒ ê·¸ë ‡ê²Œ ë³´ì´ì§€ë§Œ ì•„ë‹ˆë‹¤.     
* DIP: ì£¼ë¬¸ ì„œë¹„ìŠ¤ í´ë¼ì´ì–¸íŠ¸ `OrderServiceImpl`ëŠ” `DiscountPolicy` ì¸í„°í˜ì´ìŠ¤ì— ì˜ì¡´í•˜ê³  ìˆë‹¤.  
  * í´ë˜ìŠ¤ ì˜ì¡´ê´€ê³„ë¥¼ ì‚´í´ë³´ë©´, ì¸í„°í˜ì´ìŠ¤ ë¿ë§Œ ì•„ë‹ˆë¼ êµ¬í˜„ í´ë˜ìŠ¤ë„ ì˜ì¡´í•˜ê³  ìˆë‹¤.   
  * ì´ë¥¼ ì¢€ ë” ì‰½ê²Œ í‘œí˜„í•˜ë©´ êµ¬í˜„ì²´ê°€ ì–´ë–¤ êµ¬í˜„ì²´ì¸ì§€ ì •í™•íˆ ì•Œê³  ìˆëŠ” ìƒíƒœì´ë‹¤(new í–ˆìœ¼ë‹ˆ)    
    * ì¶”ìƒ ì¸í„°í˜ì´ìŠ¤ ì˜ì¡´ : DiscountPolicy
    * êµ¬í˜„ í´ë˜ìŠ¤ ì˜ì¡´ : FixDiscountPolicy, RateDiscountPolicy
* OCP : ì½”ë“œë¥¼ ë³€ê²½í•˜ì§€ ì•Šê³  ê¸°ëŠ¥ì„ ë³€ê²½, ì½”ë“œë¥¼ í™•ì¥í•  ìˆ˜ ìˆë‹¤ëŠ” ê°œë…         
  * ì§€ê¸ˆ ì½”ë“œëŠ” ê¸°ëŠ¥ì„ í™•ì¥í•˜ë©´, í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì— ì˜í–¥ì„ ë¯¸ì¹œë‹¤. ë”°ë¼ì„œ **OCPë¥¼ ìœ„ë°˜**í•œë‹¤.     
      
**ê·¸ë ‡ë‹¤ë©´ ì–´ë–»ê²Œ í•´ê²°í• ê¹Œ?ğŸ¤”**   
í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì¸ `OrderServiceImpl` ì€      
`DiscountPolicy` ì¸í„°í˜ì´ìŠ¤ ë¿ë§Œ ì•„ë‹ˆë¼ êµ¬í˜„ í´ë˜ìŠ¤ë„ í•¨ê»˜ ì˜ì¡´í•œë‹¤.     
ê·¸ë˜ì„œ êµ¬ì²´ í´ë˜ìŠ¤ë¥¼ ë³€ê²½í•  ë•Œ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œë„ í•¨ê»˜ ë³€ê²½í•œë‹¤.    
  
ê·¸ë ‡ë‹¤ë©´ ì–´ë–»ê²Œ í•´ê²°í• ê¹Œ? ì¸í„°í˜ì´ìŠ¤ì—ë§Œ ì˜ì¡´í•˜ë„ë¡ ì˜ì¡´ê´€ê³„ë¥¼ ë³€ê²½í•˜ë©´ ëœë‹¤.     
* **DIP ìœ„ë°˜** -> ì¶”ìƒì—ë§Œ ì˜ì¡´í•˜ë„ë¡ ë³€ê²½í•œë‹¤.(ì¸í„°í˜ì´ìŠ¤ì—ë§Œ ì˜ì¡´)      
    
**ì¸í„°í˜ì´ìŠ¤ë§Œ ì˜ì¡´ ì½”ë“œ**
```java
public class OrderServiceImpl {
    ...
    private final DiscountPolicy discountPolicy;

    ...
}
```
* ì¸í„°í˜ì´ìŠ¤ì—ë§Œ ì˜ì¡´í•˜ë„ë¡ ì½”ë“œë¥¼ êµ¬í˜„í–ˆë‹¤.  
* í•˜ì§€ë§Œ êµ¬í˜„ì²´ë¥¼ í• ë‹¹ì‹œí‚¤ì§€ ì•Šì•„ì„œ `NullPointerException` ì´ ë°œìƒí•œë‹¤.   
  
**í•´ê²° ë°©ì•ˆ**    
ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ë©´,      
ëˆ„êµ°ê°€ í´ë¼ì´ì–¸íŠ¸ì¸ `OrderServiceImpl`ì—     
`DiscountPolicy`ì˜ êµ¬í˜„ ê°ì²´ë¥¼ ëŒ€ì‹  ìƒì„±í•˜ê³  ì£¼ì…í•´ì£¼ì–´ì•¼ í•œë‹¤.     

## ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬  
ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í•˜ë‚˜ì˜ ë¡œë¯¸ì˜¤ì™€ ì¤„ë¦¬ì—£ ê³µì—°ì´ë¼ ìƒê°í•˜ì.       
ë¡œë¯¸ì˜¤ì™€ ì¤„ë¦¬ì—£ì€ ëˆ„ê°€ ë˜ë˜ì§€ ê³µì—°ë§Œ ì˜ ë§ˆë¬´ë¦¬í•˜ë©´ ìƒê´€ì´ ì—†ë‹¤.      
í•˜ì§€ë§Œ, í•œ ê°€ì§€ ìš°ë¦¬ëŠ” ê°„ê³¼í•˜ê³  ìˆëŠ” ì‚¬ì‹¤ì´ ìˆë‹¤.        
ë¡œë¯¸ì˜¤ì™€ ì¤„ë¦¬ì—£ **ë°°ì—­ì„ ë§¡ì„ ë°°ìš°ëŠ” ëˆ„ê°€ ì •í•´ì£¼ëŠ” ê²ƒì¸ê°€?**        

ë§Œì•½ ë¡œë¯¸ì˜¤ ì—­í• ì„ ë§¡ëŠ” ë””ì¹´í”„ë¦¬ì˜¤ê°€ ì´ê°™ì€ ì—­í• ì„ í•œë‹¤ê³  ê°€ì •í•´ë³´ë©´ 
ë¡œë¯¸ì˜¤ëŠ” ì•„ë˜ì™€ ê°™ì€ ì—­í• ê³¼ ì±…ì„ì„ ê°€ì§„ë‹¤.  

* ì‹¤ì œ ì—°ê·¹ì„ ìˆ˜í–‰í•  ë¡œë¯¸ì˜¤ ì—­í•  
* ë°°ìš°ë¥¼ ì„­ì™¸í•˜ê³  ë°°ì—­ì„ ì§€ì •í•´ì£¼ëŠ” ì—­í•   
   
ì´ì™€ ê°™ì€ ì‚¬ì‹¤ë¡œ ë¯¸ë£¨ì–´ë³¼ ë•Œ, ë°°ìš°ê°€ ë°°ì—­ì„ í• ë‹¹í•˜ëŠ” ì—­í• ì„ ë„ë§¡ìœ¼ë©´       
ë‹¤ì–‘í•  ì—­í• ê³¼ ì±…ì„ì„ ê°€ì§„ í•  ì¼ì´ ë§ì€ ì‚¬ëŒì´ ëœë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.    
 
**âœ” ê´€ì‹¬ì‚¬ë¥¼ ë¶„ë¦¬í•˜ì**     
* ë°°ìš°ëŠ” ë³¸ì¸ì˜ ì—­í• ì¸ ë°°ì—­ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì—ë§Œ ì§‘ì¤‘í•´ì•¼í•œë‹¤.    
* ë°°ìš°ëŠ” ìƒëŒ€ ì—¬ì ë°°ì—­ë¶„ì´ ì–´ë–¤ ë¶„ì´ ì˜¤ë”ë¼ë„ ì—­í• ì„ ì¶©ì‹¤íˆ ìˆ˜í–‰í•´ì•¼í•œë‹¤.   
* ê³µì—°ì„ êµ¬ì„±í•˜ê³ , ë‹´ë‹¹ ë°°ìš°ë¥¼ ì„­ì™¸í•˜ê³ , ë°°ìš°ë¥¼ ì§€ì •í•˜ëŠ” ì±…ì„ì€ **ê³µì—° ê¸°íšì**ê°€ í•´ì•¼í•  ì¼ì´ë‹¤.  
* ê³µì—° ê¸°íšìê°€ ì—†ë‹¤ë©´ ì´ë¥¼ ë§Œë“¤ê³ , ë°°ìš°ì™€ ê³µì—° ê¸°íšìì˜ ì±…ì„ì„ í™•ì‹¤íˆ ë¶„ë¦¬í•˜ì   
  
### AppConfig ë“±ì¥     
ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë™ì‘ ë°©ì‹ì„ êµ¬ì„±`(config)`í•˜ê¸° ìœ„í•´,     
**êµ¬í˜„ ê°ì²´ë¥¼ ìƒì„±**í•˜ê³ , **ì—°ê²°**í•˜ëŠ” ì±…ì„ì„ ê°€ì§€ëŠ” ë³„ë„ì˜ ì„¤ì • í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì     

```java
package hello.core;

import hello.core.discount.FixDiscountPolicy;
import hello.core.member.MemberService;
import hello.core.member.MemberServiceImpl;
import hello.core.member.MemoryMemberRepository;
import hello.core.order.OrderService;
import hello.core.order.OrderServiceImpl;

public class AppConfig {

    public MemberService memberService() {
        return new MemberServiceImpl(new MemoryMemberRepository());
    }

    public OrderService orderService() {
        return new OrderServiceImpl(new MemoryMemberRepository(), new FixDiscountPolicy());
    }

}
```
`AppConfig`ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì‹¤ì œ ë™ì‘ì— í•„ìš”í•œ `êµ¬í˜„ ê°ì²´ë¥¼ ìƒì„±`í•œë‹¤.       
   
* MemberServiceImpl
* MemoryMemberRepository  
* OrderServiceImpl  
* FixDiscountPolicy  

`AppConfig`ëŠ” ìƒì„±í•œ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ì˜ ì°¸ì¡°ë¥¼ `ìƒì„±ìë¥¼ í†µí•´ì„œ ì£¼ì…`í•´ì¤€ë‹¤.     
* MemberServiceImpl -> MemoryMemberRepository  
* OrderServiceImpl -> MemoryMemberRepository, FixDiscountPolicy   
  
ì°¸ê³  : ì´ ê°™ì€ ì½”ë“œë¥¼ ì ìš©í•˜ê¸° ìœ„í•´,     
ê¸°ì¡´ `new í´ë˜ìŠ¤`í•˜ëŠ” ì˜ì—­ì„ ìƒì„±ìë¡œ ì£¼ì…ë°›ë„ë¡ ì½”ë“œë¥¼ ìˆ˜ì •í•œë‹¤.     
  
**MemberServiceImpl**   
```java
package hello.core.member;

public class MemberServiceImpl implements MemberService {

    private final MemberRepository memberRepository;

    public MemberServiceImpl(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }

    @Override
    public void join(Member member) {
        memberRepository.save(member);
    }

    @Override
    public Member findMember(Long memberId) {
        return memberRepository.findById(memberId);
    }

}
```

* ì„¤ê³„ ë³€ê²½ìœ¼ë¡œ `MemberServiceImpl`ì€ `MemoryMeberRepository`ë¥¼ ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ë‹¤.     
* ë‹¨ì§€, `MemberRepoistory`ì¸í„°í˜ì´ìŠ¤ë§Œ ì˜ì¡´í•œë‹¤.     
* `MemberServiceImpl` ì…ì¥ì—ì„œ ìƒì„±ìë¥¼ í†µí•´ **ì–´ë–¤ êµ¬í˜„ ê°ì²´ê°€ ë“¤ì–´ì˜¬ì§€ëŠ” ì•Œ ìˆ˜ ì—†ë‹¤.**      
* `MemberServiceImpl` ì€ ì´ì œë¶€í„° **ì˜ì¡´ê´€ê³„ì— ëŒ€í•œ ê³ ë¯¼ì€ ì™¸ë¶€ì— ë§¡ê¸°ê³  `ì‹¤í–‰ì—ë§Œ ì§‘ì¤‘`** í•˜ë©´ ëœë‹¤.    

ì´ì œë¶€í„°, ê°ì²´ì˜ ìƒì„±ê³¼ ì—°ê²°ì€ `ApppConfig`ê°€ ë‹´ë‹¹í•œë‹¤.      
* **DIP ì™„ì„± :** 
  `MemberServiceImpl`ì€ `MemberRepository`ì¸ ì¶”ìƒì—ë§Œ ì˜ì¡´í•˜ë©´ ëœë‹¤.   
  ì¦‰, ì´ì œë¶€í„° êµ¬ì²´ í´ë˜ìŠ¤ë¥¼ ëª°ë¼ë„ ëœë‹¤.   
* **ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬ :**  
  ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ì—°ê²°í•˜ëŠ” ì—­í• ê³¼ ì‹¤í–‰í•˜ëŠ” ì—­í• ì´ ëª…í™•íˆ ë¶„ë¦¬ë˜ì–´ìˆë‹¤.   
   
**OrderServiceImpl**
```java
package hello.core.order;

import hello.core.discount.DiscountPolicy;
import hello.core.member.Member;
import hello.core.member.MemberRepository;

public class OrderServiceImpl implements OrderService{

    private final MemberRepository memberRepository;
    private final DiscountPolicy discountPolicy;

    public OrderServiceImpl(MemberRepository memberRepository, DiscountPolicy discountPolicy) {
        this.memberRepository = memberRepository;
        this.discountPolicy = discountPolicy;
    }

    @Override
    public Order createOrder(Long memberId, String itemName, int itemPrice) {
        Member member = memberRepository.findById(memberId);
        int discountPrice = discountPolicy.discount(member, itemPrice);
        return new Order(memberId, itemName, itemPrice, discountPrice);
    }
}
```
* ì„¤ê³„ ë³€ê²½ìœ¼ë¡œ `OrderServiceImpl`ì€ `FixDiscountPolicy`ë¥¼ ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ë‹¤.
* ë‹¨ì§€ `DiscountPolicy` ì¸í„°í˜ì´ìŠ¤ë§Œ ì˜ì¡´í•œë‹¤.   
* `OrderServiceImpl`ì…ì¥ì—ì„œ ìƒì„±ìë¥¼ í†µí•´ ì–´ë–¤ êµ¬í˜„ ê°ì²´ê°€ ì£¼ì…ë ì§€ëŠ” ì•Œ ìˆ˜ ì—†ë‹¤.   
* `OrderServiceImpl`ì˜ ìƒì„±ìë¥¼ í†µí•´ì„œ ì–´ë–¤ êµ¬í˜„ ê°ì²´ê°€ ì£¼ì…ë ì§€ëŠ” `AppConfig`ê°€ ê²°ì •í•œë‹¤.   
* `OrderServiceImpl`ì€ ì´ì œë¶€í„° ì‹¤í–‰ì—ë§Œ ì§‘ì¤‘í•˜ë©´ ëœë‹¤.    

**ì •ë¦¬**   
* `AppConfig`ë¥¼ í†µí•´ì„œ ê´€ì‹¬ì‚¬ë¥¼ í™•ì‹¤íˆ ë¶„ë¦¬í•˜ì  
* ë°°ì—­, ë°°ìš°ë¥¼ ìƒê°í•´ë³´ì    
* AppConfigëŠ” ê³µì—° ê¸°íšìë‹¤.   
* AppConfigëŠ” êµ¬ì²´ í´ë˜ìŠ¤ë¥¼ ì„ íƒí•œë‹¤. ë°°ì—­ì— ë§ëŠ” ë‹´ë‹¹ ë°°ìš°ë¥¼ ì„ íƒí•œë‹¤.      
* ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì–´ë–»ê²Œ ë™ì‘í•´ì•¼ í• ì§€ ì „ì²´ êµ¬ì„±ì„ ì±…ì„ì§„ë‹¤.     
* ì´ì œ ê° ë°°ìš°ë“¤ì€ ë‹´ë‹¹ ê¸°ëŠ¥ì„ ì‹¤í–‰í•˜ëŠ” ì±…ì„ë§Œ ì§€ë©´ ëœë‹¤.    
  
## AppConfig ë¦¬íŒ©í„°ë§  

```java

```
`new MemoryMemberRepository()` ì´ ë¶€ë¶„ì´ ì¤‘ë³µ ì œê±°ë˜ì—ˆë‹¤.   
ì´ì œ `MemoryMemberRepository` ë¥¼ ë‹¤ë¥¸ êµ¬í˜„ì²´ë¡œ ë³€ê²½í•  ë•Œ í•œ ë¶€ë¶„ë§Œ ë³€ê²½í•˜ë©´ ëœë‹¤.  

## 

 

