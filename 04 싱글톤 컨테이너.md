# ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ì‹±ê¸€í†¤   
ìŠ¤í”„ë§ì€ íƒœìƒì´ ê¸°ì—…ìš© ì˜¨ë¼ì¸ ì„œë¹„ìŠ¤ ê¸°ìˆ ì„ ì§€ì›í•˜ê¸° ìœ„í•´ íƒ„ìƒë˜ì—ˆë‹¤.      
ê·¸ë ‡ê¸°ì— ëŒ€ë¶€ë¶„ì˜ ìŠ¤í”„ë§ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤.    
ë¬¼ë¡ , ì›¹ì´ ì•„ë‹Œ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œë„ ì–¼ë§ˆë“ ì§€ ê°œë°œí•  ìˆ˜ë„ ìˆë‹¤.      
        
ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë™ì‘ ê³¼ì •ì—ì„œ      
ì—¬ëŸ¬ ì‚¬ëŒì´ ì ‘ê·¼í•´ì„œ ë™ì‹œì— ì—¬ëŸ¬ `request`ë¥¼ ë³´ë‚´ë©´ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ë™ì‘ì„ í• ê¹Œ?      
ë¬¼ë¡ , ì´ì „ì— ìš°ë¦¬ê°€ ë°°ì› ë“¯ì´ `DI ì»¨í…Œì´ë„ˆ`ì— ë“±ë¡ëœ ë¹ˆì„ ê°€ì§€ê³  ìš”ì²­ì„ ì²˜ë¦¬í•  ê²ƒì´ë‹¤.      
ê·¸ëŸ°ë° **ì—¬ëŸ¬ ì‚¬ëŒì´ ë™ì‹œì— ì—¬ëŸ¬ `request`ë¥¼ ë³´ë‚¸ë‹¤ëŠ”ê±°ë‹ˆê¹Œ ê°ì²´ë„ ê·¸ë§Œí¼ ë§ì´ ìƒì„±ë˜ì–´ì•¼ í•˜ë‚˜?ğŸ¤”**     
ê·¸ë ‡ë‹¤ë©´ **1000ëª…, 10000ëª…, 1ì–µëª…ì´ ë“¤ì–´ì˜¨ë‹¤ë©´ ê·¸ë§Œí¼ ê°ì²´ë¥¼ ìƒì„±í•´ì•¼í•˜ë‚˜?** ë¼ëŠ” ì˜ì‹¬ì´ ë“¤ ìˆ˜ ìˆë‹¤.    
                
ìš°ì„ , ê²°ë¡ ë¶€í„° ë§í•˜ë©´ ìŠ¤í”„ë§ì€ ê¸°ë³¸ì ìœ¼ë¡œ `ì‹±ê¸€í†¤`ìœ¼ë¡œ ë¹ˆì„ ê´€ë¦¬í•œë‹¤.             
ê·¸ë¦¬ê³  `WAS`ì˜ ì“°ë ˆë“œí’€ì— ì¡´ì¬í•˜ëŠ” ì—¬ëŸ¬ ì“°ë ˆë“œë¥¼ í†µí•´ `ë¹ˆ ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ê·¼`ì„ í•˜ëŠ” ê²ƒì´ë‹¤.   
(ë¬¼ë¡ , ì´ ê³¼ì •ì—ì„œ `thread-safe`í•œ ë¹ˆì„ ë“±ë¡í•˜ëŠ” ê²ƒì´ ì¢‹ì„ ê²ƒì´ë‹¤.)        
      
ì´ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ì„œ ê°„ë‹¨í•œ ì˜ˆì œë¥¼ ë§Œë“¤ì–´ ë³´ë ¤ê³  í•œë‹¤.  
ìš°ì„ ì€, AppConfigì—ì„œ ë°”ë¡œ ê°ì²´ë¥¼ ë°›ì•„ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ì‹  
ì¦‰, ì‹±ê¸€í†¤ì´ ì ìš©ë˜ì§€ ì•Šì€ ì½”ë“œë¥¼ ì‘ì„±í•´ë³´ê² ë‹¤.   

```java
package hello.core.singleton;

import hello.core.AppConfig;
import hello.core.member.MemberService;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;

import static org.assertj.core.api.Assertions.assertThat;

public class SingletonTest {

    @DisplayName("ìŠ¤í”„ë§ ì—†ëŠ” ìˆœìˆ˜ DI ì»¨í…Œì´ë„ˆ")
    @Test
    void pureContainer() {
        AppConfig appConfig = new AppConfig();
        // 1. ì¡°íšŒ -> í˜¸ì¶œí•  ë•Œë§ˆë‹¤ ê°ì²´ ìƒì„±í•˜ëŠ”ì§€ ì¡°íšŒ
        MemberService memberService = appConfig.memberService();

        // 2. ì¡°íšŒ -> í˜¸ì¶œí•  ë•Œë§ˆë‹¤ ê°ì²´ ìƒì„±í•˜ëŠ”ì§€ ì¡°íšŒ
        MemberService memberService2 = appConfig.memberService();

        // ì°¸ì¡°ê°’ì´ ë‹¤ë¥¸ì§€ í™•ì¸
        assertThat(memberService).isNotSameAs(memberService2);
    }


}
```
ìˆœìˆ˜í•œ `DI ì»¨í…Œì´ë„ˆ`ì¸ `AppConfig`ëŠ” ìš”ì²­ì„ í•  ë•Œ ë§ˆë‹¤ ê°ì²´ë¥¼ ìƒˆë¡œ ìƒì„±í•œë‹¤.      
ë§Œì•½, ê³ ê° íŠ¸ë˜í”½ì´ ì´ˆë‹¹ 100ì´ ë‚˜ì˜¤ë©´ ì´ˆë‹¹ 100ê°œì˜ ê°ì²´ê°€ ìƒì„±ë˜ê³  ì†Œë©¸ëœë‹¤!        
ì¦‰, ë©”ëª¨ë¦¬ ë‚­ë¹„ê°€ ì‹¬í•˜ë‹¤.           
í•´ê²°ë°©ì•ˆì€ í•´ë‹¹ ê°ì²´ê°€ ë”± 1ê°œë§Œ ìƒì„±ë˜ê³ , ê³µìœ í•˜ëŠ” ì‹±ê¸€í†¤ íŒ¨í„´ìœ¼ë¡œ ì„¤ê³„í•˜ë©´ ëœë‹¤.              
  
# ì‹±ê¸€í†¤ íŒ¨í„´   
ì‹±ê¸€í†¤ íŒ¨í„´ì´ë€, **ì¸ìŠ¤í„´ìŠ¤ê°€ ë”± 1ê°œë§Œ ìƒì„±ë˜ëŠ” ê²ƒì„ ë³´ì¥í•˜ëŠ” ë””ìì¸ íŒ¨í„´ì´ë‹¤.**     
ì£¼ë¡œ, `private` ìƒì„±ìë¥¼ ì‚¬ìš©í•´ì„œ ì™¸ë¶€ì—ì„œ ì„ì˜ë¡œ **new í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì§€ ëª»í•˜ë„ë¡ ë§‰ì•„ì•¼ í•œë‹¤**     
ì‹±ê¸€í†¤ íŒ¨í„´ì— ëŒ€í•´ì„œ [í•„ìê°€ ì •ë¦¬í•œ ë‚´ìš©]()ì´ ìˆìœ¼ë‹ˆ ì—¬ê¸¸ ì°¸ê³ í•˜ëŠ” ê±¸ ì ê·¹ ì¶”ì²œí•œë‹¤.     
  
```java
public final class SingletonService {

    private static final SingletonService instance = new SingletonService();

    private SingletonService() {}

    public static final SingletonService getInstance() {
        return instance;
    }

    public void logic() {
        System.out.println("ì‹±ê¸€í†¤ ê°ì²´ ë¡œì§ í˜¸ì¶œ");
    }
}
```
`private`ìœ¼ë¡œ `new` í‚¤ì›Œë“œë¥¼ ë§‰ì•„ë‘ì—ˆë‹¤.   
í˜¸ì¶œí•  ë•Œ ë§ˆë‹¤ ê°™ì€ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.     
  
1. `static` ì˜ì—­ì— ê°ì²´ `instance`ë¥¼ ë¯¸ë¦¬ í•˜ë‚˜ ìƒì„±í•´ì„œ ì˜¬ë ¤ë‘”ë‹¤.        
2. ì´ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ê°€ í•„ìš”í•˜ë©´ ì˜¤ì§ `getInstance() ë©”ì„œë“œ`ë¥¼ í†µí•´ì„œë§Œ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.   
  ì´ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ í•­ìƒ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤.      
3. ë”± 1ê°œì˜ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë§Œ ì¡´ì¬í•´ì•¼ í•˜ë¯€ë¡œ, ìƒì„±ìë¥¼ `private`ìœ¼ë¡œ ë§‰ì•„ì„œ        
í˜¹ì‹œë¼ë„ ì™¸ë¶€ì—ì„œ `new` í‚¤ì›Œë“œë¡œ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ë˜ëŠ” ê²ƒì„ ë§‰ëŠ”ë‹¤.        

```java
  
package hello.core.singleton;

import hello.core.AppConfig;
import hello.core.member.MemberService;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;

import static org.assertj.core.api.Assertions.assertThat;

public class SingletonTest {

    @DisplayName("ìŠ¤í”„ë§ ì—†ëŠ” ìˆœìˆ˜ DI ì»¨í…Œì´ë„ˆ")
    @Test
    void pureContainer() {
        AppConfig appConfig = new AppConfig();
        // 1. ì¡°íšŒ -> í˜¸ì¶œí•  ë•Œë§ˆë‹¤ ê°ì²´ ìƒì„±í•˜ëŠ”ì§€ ì¡°íšŒ
        MemberService memberService1 = appConfig.memberService();

        // 2. ì¡°íšŒ -> í˜¸ì¶œí•  ë•Œë§ˆë‹¤ ê°ì²´ ìƒì„±í•˜ëŠ”ì§€ ì¡°íšŒ
        MemberService memberService2 = appConfig.memberService();

        // ì°¸ì¡°ê°’ì´ ë‹¤ë¥¸ì§€ í™•ì¸
        assertThat(memberService1).isNotSameAs(memberService2);
    }

    @DisplayName("ì‹±ê¸€í†¤ íŒ¨í„´ì„ ì ìš©í•œ ì‚¬ë¡€")
    @Test
    void singletonServiceTest() {
        SingletonService singletonService1 = SingletonService.getInstance();
        SingletonService singletonService2 = SingletonService.getInstance();

        System.out.println("singletonService1 = " + singletonService1);
        System.out.println("singletonService2 = " + singletonService2);

        assertThat(singletonService1).isSameAs(singletonService2);

        singletonService1.logic();
    }

}
```
ì‹±ê¸€í†¤ íŒ¨í„´ì„ ì ìš©í•˜ë©´ ê³ ê°ì˜ ìš”ì²­ì´ ì˜¬ ë•Œ ë§ˆë‹¤ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼,      
ì´ë¯¸ ë§Œë“¤ì–´ì§„ ê°ì²´ë¥¼ ê³µìœ í•´ì„œ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.       
í•˜ì§€ë§Œ ì‹±ê¸€í†¤ íŒ¨í„´ì€ ë‹¤ìŒê³¼ ê°™ì€ ìˆ˜ ë§ì€ ë¬¸ì œì ë“¤ì„ ê°€ì§€ê³  ìˆë‹¤.    

**ì‹±ê¸€í†¤ íŒ¨í„´ ë¬¸ì œì **
* ì‹±ê¸€í†¤ íŒ¨í„´ì„ êµ¬í˜„í•˜ëŠ” ì½”ë“œ ìì²´ê°€ ë§ì´ ë“¤ì–´ê°„ë‹¤.
* ì˜ì¡´ê´€ê³„ìƒ í´ë¼ì´ì–¸íŠ¸ê°€ êµ¬ì²´ í´ë˜ìŠ¤ì— ì˜ì¡´í•œë‹¤. DIPë¥¼ ìœ„ë°˜í•œë‹¤.
* í´ë¼ì´ì–¸íŠ¸ê°€ êµ¬ì²´ í´ë˜ìŠ¤ì— ì˜ì¡´í•´ì„œ OCP ì›ì¹™ì„ ìœ„ë°˜í•  ê°€ëŠ¥ì„±ì´ ë†’ë‹¤.
* í…ŒìŠ¤íŠ¸í•˜ê¸° ì–´ë µë‹¤.
* ë‚´ë¶€ ì†ì„±ì„ ë³€ê²½í•˜ê±°ë‚˜ ì´ˆê¸°í™” í•˜ê¸° ì–´ë µë‹¤.
* private ìƒì„±ìë¡œ ìì‹ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê¸° ì–´ë µë‹¤.
* ê²°ë¡ ì ìœ¼ë¡œ ìœ ì—°ì„±ì´ ë–¨ì–´ì§„ë‹¤.
* ì•ˆí‹°íŒ¨í„´ìœ¼ë¡œ ë¶ˆë¦¬ê¸°ë„ í•œë‹¤.

# ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆ  
ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ì‹±ê¸€í†¤ íŒ¨í„´ì˜ ë¬¸ì œë¥¼ í•´ê²°í•˜ë©´ì„œ, ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬í•œë‹¤.   
    
**ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆ**      
* ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ë³„ë‹¤ë¥¸ ì§€ì •ì„ í•˜ì§€ ì•Šì„ ê²½ìš°, ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬í•œë‹¤.   
* ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì—ì„œ ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆ ì—­í• ì„ í•˜ê³ ,   
  ì‹±ê¸€í†¤ìœ¼ë¡œ ê°ì²´ë¥¼ ê´€í•˜ê³  ìƒì„±í•˜ëŠ” ê¸°ëŠ¥ì„ **ì‹±ê¸€í†¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬**ë¼ í•œë‹¤.     
* **ì‹±ê¸€í†¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬** ë•ë¶„ì— ì‹±ê¸€í„´ íŒ¨í„´ì˜ ëª¨ë“  ë‹¨ì ì„ í•´ê²°í•˜ë©´ì„œ ê°ì²´ë¥¼ ì‹±ê¸€í†¤ìœ¼ë¡œ ìœ ì§€í•  ìˆ˜ ìˆë‹¤.  
  * ì‹±ê¸€í†¤ íŒ¨í„´ì„ ìœ„í•œ ì§€ì €ë¶„í•œ ì½”ë“œê°€ ë“¤ì–´ê°€ì§€ ì•Šì•„ë„ ëœë‹¤.   
  * DIP, OCP, í…ŒìŠ¤íŠ¸, private ìƒì„±ìë¡œë¶€í„° ììœ ë¡­ê²Œ ì‹±ê¸€í†¤ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.    

```java
package hello.core.singleton;

import hello.core.AppConfig;
import hello.core.member.MemberService;
import hello.core.member.MemberServiceImpl;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;

import static org.assertj.core.api.Assertions.assertThat;

public class SingletonTest {

    @DisplayName("ìŠ¤í”„ë§ ì—†ëŠ” ìˆœìˆ˜ DI ì»¨í…Œì´ë„ˆ")
    @Test
    void pureContainer() {
        AppConfig appConfig = new AppConfig();
        // 1. ì¡°íšŒ -> í˜¸ì¶œí•  ë•Œë§ˆë‹¤ ê°ì²´ ìƒì„±í•˜ëŠ”ì§€ ì¡°íšŒ
        MemberService memberService1 = appConfig.memberService();

        // 2. ì¡°íšŒ -> í˜¸ì¶œí•  ë•Œë§ˆë‹¤ ê°ì²´ ìƒì„±í•˜ëŠ”ì§€ ì¡°íšŒ
        MemberService memberService2 = appConfig.memberService();

        // ì°¸ì¡°ê°’ì´ ë‹¤ë¥¸ì§€ í™•ì¸
        assertThat(memberService1).isNotSameAs(memberService2);
    }

    @DisplayName("ì‹±ê¸€í†¤ íŒ¨í„´ì„ ì ìš©í•œ ì‚¬ë¡€")
    @Test
    void singletonServiceTest() {
        SingletonService singletonService1 = SingletonService.getInstance();
        SingletonService singletonService2 = SingletonService.getInstance();

        System.out.println("singletonService1 = " + singletonService1);
        System.out.println("singletonService2 = " + singletonService2);

        assertThat(singletonService1).isSameAs(singletonService2);

        singletonService1.logic();
    }

    @DisplayName("ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì™€ ì‹±ê¸€í†¤")
    @Test
    void springContainer() {
        AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);
        // 1. ì¡°íšŒ -> í˜¸ì¶œí•  ë•Œë§ˆë‹¤ ê°ì²´ ìƒì„±í•˜ëŠ”ì§€ ì¡°íšŒ
        MemberService memberService1 = ac.getBean("memberService", MemberServiceImpl.class);

        // 2. ì¡°íšŒ -> í˜¸ì¶œí•  ë•Œë§ˆë‹¤ ê°ì²´ ìƒì„±í•˜ëŠ”ì§€ ì¡°íšŒ
        MemberService memberService2 = ac.getBean("memberService", MemberServiceImpl.class);

        System.out.println("singletonService1 = " + memberService1);
        System.out.println("singletonService2 = " + memberService2);

        // ì°¸ì¡°ê°’ì´ ë‹¤ë¥¸ì§€ í™•ì¸
        assertThat(memberService1).isSameAs(memberService2);
    }


}
```
ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ë•ë¶„ì— ê³ ê°ì˜ ìš”ì²­ì´ ì˜¬ ë•Œ ë§ˆë‹¤ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼,   
ì´ë¯¸ ë§Œë“¤ì–´ì§„ ê°ì²´ë¥¼ ê³µìœ í•´ì„œ íš¨ìœ¨ì ìœ¼ë¡œ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.    

# ì‹±ê¸€í†¤ ë°©ì‹ì˜ ì£¼ì˜ì         
`ì‹±ê¸€í†¤ íŒ¨í„´`ì´ë“ , ìŠ¤í”„ë§ ê°™ì€ `ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆ`ë¥¼ ì‚¬ìš©í•˜ë“ ,        
ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í•˜ë‚˜ë§Œ ìƒì„±í•´ì„œ ê³µìœ í•˜ëŠ” **ì‹±ê¸€í†¤ ë°©ì‹ì€**     
ì—¬ëŸ¬ í´ë¼ì´ì–¸íŠ¸ê°€ í•˜ë‚˜ì˜ ê°™ì€ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê³µìœ í•˜ê¸° ë•Œë¬¸ì—        
ì‹±ê¸€í†¤ ê°ì²´ëŠ” **ìƒíƒœë¥¼ ìœ ì§€(stateful)í•˜ê²Œ ì„¤ê³„í•˜ë©´ ì•ˆëœë‹¤.**      
                  
**ë¬´ìƒíƒœ(stateless)ë¡œ ì„¤ê³„í•´ì•¼ í•œë‹¤!**        
* íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ì— ì˜ì¡´ì ì¸ í•„ë“œê°€ ìˆìœ¼ë©´ ì•ˆ ëœë‹¤.        
* íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ê°€ ê°’ì„ ë³€ê²½í•  ìˆ˜ ìˆëŠ” í•„ë“œê°€ ìˆìœ¼ë©´ ì•ˆëœë‹¤! (ìƒìˆ˜ëŠ” ê°€ëŠ¥)        
* ê°€ê¸‰ì  ì½ê¸°ë§Œ ê°€ëŠ¥í•´ì•¼ í•œë‹¤.         
* í•„ë“œ ëŒ€ì‹ ì— ìë°”ì—ì„œ ê³µìœ ë˜ì§€ ì•ŠëŠ”, `ì§€ì—­ë³€ìˆ˜`, `íŒŒë¼ë¯¸í„°`, `ThreadLocal` ë“±ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.     
* **ìŠ¤í”„ë§ ë¹ˆì˜ í•„ë“œì— ê³µìœ  ê°’ì„ ì„¤ì •í•˜ë©´ ì •ë§ í° ì¥ì• ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤!**            
        
```java
package hello.core.singleton;

public class StatefulService {

    private int price;  // ìƒíƒœê°€ ìœ ì§€ë˜ëŠ” ë³€ìˆ˜

    public void order(String name, int price) {
        System.out.println("name = " + name + " price = " + price);
        this.price = price; // ë¬¸ì œê°€ ë˜ëŠ” ì˜ì—­
    }

    public int getPrice() {
        return price;
    }

}
```
```java
package hello.core.singleton;

import org.junit.jupiter.api.Test;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
import org.springframework.context.annotation.Bean;

import static org.assertj.core.api.Assertions.assertThat;
import static org.junit.jupiter.api.Assertions.*;

class StatefulServiceTest {

    @Test
    void StatefulServiceSingleton() {
        AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(TestConfig.class);
        StatefulService statefulService1 = ac.getBean("statefulService", StatefulService.class);
        StatefulService statefulService2 = ac.getBean("statefulService", StatefulService.class);

        statefulService1.order("userA", 10000);
        statefulService1.order("userB", 20000);

        //ThreadA : ì‚¬ìš©ì ì£¼ë¬¸ ê¸ˆì•¡ ì¡°íšŒ
        int priceA = statefulService1.getPrice();
        int priceB = statefulService1.getPrice();

        System.out.println("priceA = " + priceA);   // ê°’ì´ ì˜ˆìƒê³¼ ë‹¤ë¥´ê²Œ ë‚˜ì˜¨ë‹¤.
        System.out.println("priceB = " + priceB);

        assertThat(priceA).isEqualTo(priceB); // ì˜ëª»ëœ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ê¹Œì§€ í†µê³¼ëœë‹¤.
    }

    static class TestConfig {
        @Bean
        public StatefulService statefulService() {
            return new StatefulService();
        }

    }
} 
```
* ThreadAê°€ ì‚¬ìš©ìA ì½”ë“œë¥¼ í˜¸ì¶œí•˜ê³  ThreadBê°€ ì‚¬ìš©ìB ì½”ë“œë¥¼ í˜¸ì¶œí•œë‹¤ ê°€ì •í•˜ì.  
        
`StatefulService`ì˜ `price` í•„ë“œëŠ” ê³µìœ ë˜ëŠ” í•„ë“œì¸ë°, íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ê°€ ê°’ì„ ë³€ê²½í•œë‹¤.     
`ì‚¬ìš©ìA`ì˜ ì£¼ë¬¸ê¸ˆì•¡ì€ 10000ì›ì´ ë˜ì–´ì•¼ í•˜ëŠ”ë°, 20000ì›ì´ë¼ëŠ” ê²°ê³¼ê°€ ë‚˜ì™”ë‹¤.        
ì‹¤ë¬´ì—ì„œ ì´ëŸ° ê²½ìš°ë¥¼ ì¢…ì¢… ë³´ëŠ”ë°, ì´ë¡œì¸í•´ ì •ë§ í•´ê²°í•˜ê¸° ì–´ë ¤ìš´ í° ë¬¸ì œë“¤ì´ í„°ì§„ë‹¤.  
**ê³µìœ  í•„ë“œëŠ” ì œì¼ ì¡°ì‹¬í•´ì•¼ í•˜ê³  ê¼­ ìŠ¤í”„ë§ ë¹ˆì€ í•­ìƒ ë¬´ìƒíƒœ(stateless)ë¡œ ì„¤ê³„í•˜ì.**      
        
```java
package hello.core.singleton;

public class StatefulService {

    public int order(String name, int price) {
        System.out.println("name = " + name + " price = " + price);
        return price;
    }

}
```
```java
package hello.core.singleton;

import org.junit.jupiter.api.Test;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
import org.springframework.context.annotation.Bean;

import static org.assertj.core.api.Assertions.assertThat;
import static org.junit.jupiter.api.Assertions.*;

class StatefulServiceTest {

    @Test
    void StatefulServiceSingleton() {
        AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(TestConfig.class);
        StatefulService statefulService1 = ac.getBean("statefulService", StatefulService.class);
        StatefulService statefulService2 = ac.getBean("statefulService", StatefulService.class);

        int priceA = statefulService1.order("userA", 10000);
        int priceB =  statefulService1.order("userB", 20000);

        System.out.println("priceA = " + priceA);   // ê°’ì´ ì˜ˆìƒê³¼ ë‹¤ë¥´ê²Œ ë‚˜ì˜¨ë‹¤.
        System.out.println("priceB = " + priceB);

        assertThat(priceA).isNotEqualTo(priceB); // ì˜ëª»ëœ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ê¹Œì§€ í†µê³¼ëœë‹¤.
    }

    static class TestConfig {
        @Bean
        public StatefulService statefulService() {
            return new StatefulService();
        }

    }
}
```
ë¬´ìƒíƒœì„±ì„ ë„ë„ë¡ ì½”ë“œë¥¼ ë¦¬íŒ©í„°ë§ í–ˆë‹¤.  
    
# @Configurationê³¼ ì‹±ê¸€í†¤      

**AppConfig**
```java
package hello.core;

import hello.core.discount.DiscountPolicy;
import hello.core.discount.FixDiscountPolicy;
import hello.core.discount.RateDiscountPolicy;
import hello.core.member.MemberRepository;
import hello.core.member.MemberService;
import hello.core.member.MemberServiceImpl;
import hello.core.member.MemoryMemberRepository;
import hello.core.order.OrderService;
import hello.core.order.OrderServiceImpl;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class AppConfig {

    @Bean
    public MemberService memberService() {
        return new MemberServiceImpl(memberRepository());
    }

    @Bean
    public OrderService orderService() {
        return new OrderServiceImpl(memberRepository(), discountPolicy());
    }

    @Bean
    public MemberRepository memberRepository() {
        return new MemoryMemberRepository();
    }

    @Bean
    public DiscountPolicy discountPolicy() {
        return new RateDiscountPolicy();
    }

}
```
`AppConfig` í´ë˜ìŠ¤ë¥¼ ë³´ë‹¤ë³´ë©´ ì˜ì‹¬ì´ê°€ëŠ” ë¶€ë¶„ì´ ëª‡ê°€ì§€ ìˆë‹¤.     
ë°”ë¡œ, `MemberRepository` ë¹ˆì„ ë§Œë“œëŠ” ë©”ì„œë“œê°€ ì´ 3ë²ˆ í˜¸ì¶œë˜ê¸° ë•Œë¬¸ì´ë‹¤.   
ê·¸ë ‡ê¸°ì— `3ê°œì˜ ê°ì²´ë¥¼ ë§Œë“ ëŠ ê²ƒì€ ì•„ë‹Œì§€`, `ì‹±ê¸€í†¤ íŒ¨í„´ì€ ê¹¨ì§€ëŠ”ê²Œ ì•„ë‹Œì§€` ìƒê°í•˜ê²Œ ëœë‹¤.    

ì´ë¥¼ í™•ì¸í•´ë³´ê¸° ìœ„í•´ ì•„ë˜ì™€ ê°™ì´ ì½”ë“œë¥¼ ìˆ˜ì •í•´ë³´ì  
   
**MemberServiceImpl í´ë˜ìŠ¤**
```java
package hello.core.member;

public class MemberServiceImpl implements MemberService {

    private final MemberRepository memberRepository;

    public MemberServiceImpl(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }

    @Override
    public void join(Member member) {
        memberRepository.save(member);
    }

    @Override
    public Member findMember(Long memberId) {
        return memberRepository.findById(memberId);
    }

    // í…ŒìŠ¤íŠ¸ìš© ë©”ì„œë“œ
    public MemberRepository getMemberRepository() {
        return memberRepository;
    }

}
```
   
**OrderServiceImpl í´ë˜ìŠ¤**
```java
package hello.core.order;

import hello.core.discount.DiscountPolicy;
import hello.core.member.Member;
import hello.core.member.MemberRepository;

public class OrderServiceImpl implements OrderService{

    private final MemberRepository memberRepository;
    private final DiscountPolicy discountPolicy;

    public OrderServiceImpl(MemberRepository memberRepository, DiscountPolicy discountPolicy) {
        this.memberRepository = memberRepository;
        this.discountPolicy = discountPolicy;
    }

    @Override
    public Order createOrder(Long memberId, String itemName, int itemPrice) {
        Member member = memberRepository.findById(memberId);
        int discountPrice = discountPolicy.discount(member, itemPrice);
        return new Order(memberId, itemName, itemPrice, discountPrice);
    }

    // í…ŒìŠ¤íŠ¸ ìš©ë„
    public MemberRepository getMemberRepository() {
        return memberRepository;
    }

}
```
  
**ConfigurationSingletonTest í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤**   
```java
package hello.core.singleton;

import hello.core.AppConfig;
import hello.core.member.MemberRepository;
import hello.core.member.MemberService;
import hello.core.member.MemberServiceImpl;
import hello.core.order.OrderService;
import hello.core.order.OrderServiceImpl;
import org.junit.jupiter.api.Test;
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;

import static org.assertj.core.api.Assertions.assertThat;
import static org.junit.jupiter.api.Assertions.assertAll;

public class ConfigurationSingletonTest {

    @Test
    void configurationTest() {
        ApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);

        MemberServiceImpl memberService = ac.getBean("memberService", MemberServiceImpl.class);
        OrderServiceImpl orderService = ac.getBean("orderService", OrderServiceImpl.class);
        MemberRepository memberRepository = ac.getBean("memberRepository", MemberRepository.class);

        MemberRepository memberRepository1 = memberService.getMemberRepository();
        MemberRepository memberRepository2 = orderService.getMemberRepository();

        System.out.println("MemberRepository = " + memberRepository);
        System.out.println("memberService -> MemberRepository = " + memberRepository1);
        System.out.println("orderService -> MemberRepository = " + memberRepository2);

        assertAll(
                () -> assertThat(memberRepository).isSameAs(memberRepository1),
                () -> assertThat(memberRepository).isSameAs(memberRepository2),
                () -> assertThat(memberRepository1).isSameAs(memberRepository2)
        );

    }
}
```
**AppConfig ë¡œê·¸ ê¸°ë¡**
```java
package hello.core;

import hello.core.discount.DiscountPolicy;
import hello.core.discount.FixDiscountPolicy;
import hello.core.discount.RateDiscountPolicy;
import hello.core.member.MemberRepository;
import hello.core.member.MemberService;
import hello.core.member.MemberServiceImpl;
import hello.core.member.MemoryMemberRepository;
import hello.core.order.OrderService;
import hello.core.order.OrderServiceImpl;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class AppConfig {

    @Bean
    public MemberService memberService() {
        System.out.println("call AppConfig.memberService");
        return new MemberServiceImpl(memberRepository());
    }

    @Bean
    public OrderService orderService() {
        System.out.println("call AppConfig.orderService");
        return new OrderServiceImpl(memberRepository(), discountPolicy());
    }

    @Bean
    public MemberRepository memberRepository() {
        System.out.println("call AppConfig.memberRepository");
        return new MemoryMemberRepository();
    }

    @Bean
    public DiscountPolicy discountPolicy() {
        System.out.println("call AppConfig.discountPolicy");
        return new RateDiscountPolicy();
    }

}
```
ì‹¤ì œ ë¡œê·¸ë¥¼ ìœ„í•œ ì¶œë ¥ë¬¸ì„ ì‚´í´ë³´ë©´      
3ê°œì˜ ì¸ìŠ¤í„´ìŠ¤ ëª¨ë‘ ê°™ì€ ì£¼ì†Œê°’ì„ ê°€ì§„ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©°         
ê°ì²´ ìƒì„±ì„ ë”± 1ë²ˆë§Œ í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆë‹¤.      
     
# @Configurationê³¼ ë°”ì´íŠ¸ì½”ë“œ ì¡°ì‘ì˜ ë§ˆë²• 
   
ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ì‹±ê¸€í†¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë‹¤.   
ë”°ë¼ì„œ ìŠ¤í”„ë§ ë¹ˆì´ ì‹±ê¸€í†¤ì´ ë˜ë„ë¡ ë³´ì¥í•´ì£¼ì–´ì•¼ í•œë‹¤.         
ê·¸ëŸ°ë° ìŠ¤í”„ë§ì´ ìë°” ì½”ë“œê¹Œì§€ ì–´ë–»ê²Œ í•˜ê¸°ëŠ” ì–´ë µë‹¤.          
ì € ìë°” ì½”ë“œë¥¼ ë³´ë©´ ë¶„ëª… 3ë²ˆ í˜¸ì¶œë˜ì–´ì•¼ í•˜ëŠ” ê²ƒì´ ë§ë‹¤.     
ê·¸ë˜ì„œ ìŠ¤í”„ë§ì€ í´ë˜ìŠ¤ì˜ ë°”ì´íŠ¸ì½”ë“œë¥¼ ì¡°ì‘í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œë‹¤.     
ëª¨ë“  ë¹„ë°€ì€ `@Configuration` ì„ ì ìš©í•œ `AppConfig` ì— ìˆë‹¤.     
     
```java
    @Test
    void configurationDeep() {
        ApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);
        AppConfig bean = ac.getBean(AppConfig.class);

        System.out.println("bean = " + bean.getClass());
    }
```
`AppConfig` ë˜í•œ, `@Configuration`ì˜ `@Component` ì–´ë…¸í…Œì´ì…˜ ë•ë¶„ì— ë¹ˆìœ¼ë¡œ ë“±ë¡ë˜ì–´ ê´€ë¦¬ëœë‹¤.   

```java
bean = class hello.core.AppConfig$$EnhancerBySpringCGLIB$$cf0c57fa
```
`AppConfig ë¹ˆ`ì„ ê²€ìƒ‰í•´ì„œ ì¶œë ¥í•´ë³´ë©´, ìœ„ì™€ ê°™ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.        

```java
hello.core.AppConfig
```
ìš°ì„ , ìˆœìˆ˜í•œ í´ë˜ìŠ¤ë¼ë©´ ìœ„ì™€ ê°™ì´ ì¶œë ¥ì´ ë˜ì–´ì•¼ í•œë‹¤.     
ê·¸ëŸ°ë° ì˜ˆìƒê³¼ëŠ” ë‹¤ë¥´ê²Œ í´ë˜ìŠ¤ ëª…ì— xxxCGLIBê°€ ë¶™ìœ¼ë©´ì„œ ìƒë‹¹íˆ ë³µì¡í•´ì§„ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.   
ì´ê²ƒì€ ë‚´ê°€ ë§Œë“  í´ë˜ìŠ¤ê°€ ì•„ë‹ˆë¼ ìŠ¤í”„ë§ì´ CGLIBë¼ëŠ” ë°”ì´íŠ¸ì½”ë“œ ì¡°ì‘ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ì„œ AppConfig í´ë˜ìŠ¤
ë¥¼ ìƒì†ë°›ì€ ì„ì˜ì˜ ë‹¤ë¥¸ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê³ , ê·¸ ë‹¤ë¥¸ í´ë˜ìŠ¤ë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•œ ê²ƒì´ë‹¤!

  
  
  

